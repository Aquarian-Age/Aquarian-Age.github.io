<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Mysql2SQLite3 | 浮生若梦</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="https:&#x2F;&#x2F;github.com&#x2F;dumblob&#x2F;mysql2sqlite">
<meta property="og:type" content="article">
<meta property="og:title" content="Mysql2SQLite3">
<meta property="og:url" content="https://aquarian-age.github.io/2021/09/29/Mysql2SQLite3/index.html">
<meta property="og:site_name" content="浮生若梦">
<meta property="og:description" content="https:&#x2F;&#x2F;github.com&#x2F;dumblob&#x2F;mysql2sqlite">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-09-28T23:33:07.000Z">
<meta property="article:modified_time" content="2021-09-28T23:36:08.944Z">
<meta property="article:author" content="Aquarian-Age">
<meta property="article:tag" content="Go">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="浮生若梦" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
  
  
<link rel="stylesheet" href="/css/style.css">

  

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://Aquarian-Age.github.io"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="https://aquarian-age.github.io/2018/01/31/about/">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">浮生若梦</a>
      </h1>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Mysql2SQLite3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/09/29/Mysql2SQLite3/" class="article-date">
  <time datetime="2021-09-28T23:33:07.000Z" itemprop="datePublished">2021-09-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Mysql2SQLite3
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p><a target="_blank" rel="noopener" href="https://github.com/dumblob/mysql2sqlite">https://github.com/dumblob/mysql2sqlite</a></p>
<span id="more"></span>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u userName -ppassword --skip-extended-insert --databases DbName &gt; dump_mysql.sql</span><br><span class="line"><span class="built_in">chmod</span> +x mysql2sqlite</span><br><span class="line">./mysql2sqlite dump_mysql.sql | sqlite3 mysqlite3.db</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/awk -f</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Authors: @esperlu, @artemyk, @gkuenning, @dumblob</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">FIXME detect empty input file and issue a warning</span></span><br><span class="line"></span><br><span class="line">function printerr( s )&#123; print s | &quot;cat &gt;&amp;2&quot; &#125;</span><br><span class="line"></span><br><span class="line">BEGIN &#123;</span><br><span class="line">		if( ARGC != 2 )&#123;</span><br><span class="line">				printerr( \</span><br><span class="line">								&quot;USAGE:\n&quot;\</span><br><span class="line">								&quot;       mysql2sqlite dump_mysql.sql &gt; dump_sqlite3.sql\n&quot; \</span><br><span class="line">								&quot;       OR\n&quot; \</span><br><span class="line">								&quot;       mysql2sqlite dump_mysql.sql | sqlite3 sqlite.db\n&quot; \</span><br><span class="line">								&quot;\n&quot; \</span><br><span class="line">								&quot;NOTES:\n&quot; \</span><br><span class="line">								&quot;       Dash in filename is not supported, because dash (-) means stdin.&quot; )</span><br><span class="line">						no_END = 1</span><br><span class="line">						exit 1</span><br><span class="line">		&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Find INT_MAX supported by both this AWK (usually an ISO C signed int)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  and SQlite.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">On non-8bit-based architectures, the additional bits are safely ignored.</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">8bit (lower precision should not exist)</span></span><br><span class="line">		s=&quot;127&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;63&quot;</span> + 0 avoids potential parser misbehavior</span></span><br><span class="line">				if( (s + 0) &quot;&quot; == s )&#123; INT_MAX_HALF = &quot;63&quot; + 0 &#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">16bit</span></span><br><span class="line">		s=&quot;32767&quot;</span><br><span class="line">				if( (s + 0) &quot;&quot; == s )&#123; INT_MAX_HALF = &quot;16383&quot; + 0 &#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">32bit</span></span><br><span class="line">		s=&quot;2147483647&quot;</span><br><span class="line">				if( (s + 0) &quot;&quot; == s )&#123; INT_MAX_HALF = &quot;1073741823&quot; + 0 &#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">64bit (as INTEGER <span class="keyword">in</span> SQlite3)</span></span><br><span class="line">		s=&quot;9223372036854775807&quot;</span><br><span class="line">				if( (s + 0) &quot;&quot; == s )&#123; INT_MAX_HALF = &quot;4611686018427387904&quot; + 0 &#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> <span class="comment"># 128bit</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> s=<span class="string">&quot;170141183460469231731687303715884105728&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> <span class="keyword">if</span>( (s + 0) <span class="string">&quot;&quot;</span> == s )&#123; INT_MAX_HALF = <span class="string">&quot;85070591730234615865843651857942052864&quot;</span> + 0 &#125;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> <span class="comment"># 256bit</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> s=<span class="string">&quot;57896044618658097711785492504343953926634992332820282019728792003956564819968&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> <span class="keyword">if</span>( (s + 0) <span class="string">&quot;&quot;</span> == s )&#123; INT_MAX_HALF = <span class="string">&quot;28948022309329048855892746252171976963317496166410141009864396001978282409984&quot;</span> + 0 &#125;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> <span class="comment"># 512bit</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> s=<span class="string">&quot;6703903964971298549787012499102923063739682910296196688861780721860882015036773488400937149083451713845015929093243025426876941405973284973216824503042048&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> <span class="keyword">if</span>( (s + 0) <span class="string">&quot;&quot;</span> == s )&#123; INT_MAX_HALF = <span class="string">&quot;3351951982485649274893506249551461531869841455148098344430890360930441007518386744200468574541725856922507964546621512713438470702986642486608412251521024&quot;</span> + 0 &#125;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> <span class="comment"># 1024bit</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> s=<span class="string">&quot;89884656743115795386465259539451236680898848947115328636715040578866337902750481566354238661203768010560056939935696678829394884407208311246423715319737062188883946712432742638151109800623047059726541476042502884419075341171231440736956555270413618581675255342293149119973622969239858152417678164812112068608&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> <span class="keyword">if</span>( (s + 0) <span class="string">&quot;&quot;</span> == s )&#123; INT_MAX_HALF = <span class="string">&quot;44942328371557897693232629769725618340449424473557664318357520289433168951375240783177119330601884005280028469967848339414697442203604155623211857659868531094441973356216371319075554900311523529863270738021251442209537670585615720368478277635206809290837627671146574559986811484619929076208839082406056034304&quot;</span> + 0 &#125;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> <span class="comment"># higher precision probably not needed</span></span></span><br><span class="line"></span><br><span class="line">		FS=&quot;,$&quot;</span><br><span class="line">				print &quot;PRAGMA synchronous = OFF;&quot;</span><br><span class="line">				print &quot;PRAGMA journal_mode = MEMORY;&quot;</span><br><span class="line">				print &quot;BEGIN TRANSACTION;&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">historically 3 spaces separate non-argument <span class="built_in">local</span> variables</span></span><br><span class="line">function bit_to_int( str_bit,   powtwo, i, res, bit, overflow )&#123;</span><br><span class="line">		powtwo = 1</span><br><span class="line">				overflow = 0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">011101 = 1*2^0 + 0*2^1 + 1*2^2 ...</span></span><br><span class="line">				for( i = length( str_bit ); i &gt; 0; --i )&#123;</span><br><span class="line">						bit = substr( str_bit, i, 1 )</span><br><span class="line">								if( overflow || ( bit == 1 &amp;&amp; res &gt; INT_MAX_HALF ) )&#123;</span><br><span class="line">										printerr( \</span><br><span class="line">														NR &quot;: WARN Bit field overflow, number truncated (LSBs saved, MSBs ignored).&quot; )</span><br><span class="line">												break</span><br><span class="line">								&#125;</span><br><span class="line">						res = res + bit * powtwo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">no warning here as it might be the last iteration</span></span><br><span class="line">								if( powtwo &gt; INT_MAX_HALF )&#123; overflow = 1; continue &#125;</span><br><span class="line">						powtwo = powtwo * 2</span><br><span class="line">				&#125;</span><br><span class="line">		return res</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CREATE TRIGGER statements have funny commenting. Remember we are <span class="keyword">in</span> trigger.</span></span><br><span class="line">/^\/\*.*(CREATE.*TRIGGER|create.*trigger)/ &#123;</span><br><span class="line">		gsub( /^.*(TRIGGER|trigger)/, &quot;CREATE TRIGGER&quot; )</span><br><span class="line">				print</span><br><span class="line">				inTrigger = 1</span><br><span class="line">				next</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The end of CREATE TRIGGER has a stray comment terminator</span></span><br><span class="line">/(END|end) \*\/;;/ &#123; gsub( /\*\//, &quot;&quot; ); print; inTrigger = 0; next &#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The rest of triggers just get passed through</span></span><br><span class="line">inTrigger != 0 &#123; print; next &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CREATE VIEW looks like a TABLE <span class="keyword">in</span> comments</span></span><br><span class="line">/^\/\*.*(CREATE.*TABLE|create.*table)/ &#123;</span><br><span class="line">		inView = 1</span><br><span class="line">				next</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">end of CREATE VIEW</span></span><br><span class="line">/^(\).*(ENGINE|engine).*\*\/;)/ &#123;</span><br><span class="line">		inView = 0</span><br><span class="line">				next</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">content of CREATE VIEW</span></span><br><span class="line">inView != 0 &#123; next &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">skip comments</span></span><br><span class="line">/^\/\*/ &#123; next &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">skip PARTITION statements</span></span><br><span class="line">/^ *[(]?(PARTITION|partition) +[^ ]+/ &#123; next &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">print</span> all INSERT lines</span></span><br><span class="line">				( /^ *\(/ &amp;&amp; /\) *[,;] *$/ ) || /^(INSERT|insert|REPLACE|replace)/ &#123;</span><br><span class="line">				prev = &quot;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">first replace \\ by \_ that mysqldump never generates to deal with</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sequnces like \\n that should be translated into \n, not \&lt;LF&gt;.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">After we convert all escapes we replace \_ by backslashes.</span></span><br><span class="line">				gsub( /\\\\/, &quot;\\_&quot; )</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">single quotes are escaped by another single quote</span></span><br><span class="line">				gsub( /\\&#x27;/, &quot;&#x27;&#x27;&quot; )</span><br><span class="line">				gsub( /\\n/, &quot;\n&quot; )</span><br><span class="line">				gsub( /\\r/, &quot;\r&quot; )</span><br><span class="line">				gsub( /\\&quot;/, &quot;\&quot;&quot; )</span><br><span class="line">				gsub( /\\\032/, &quot;\032&quot; )  # substitute char</span><br><span class="line"></span><br><span class="line">				gsub( /\\_/, &quot;\\&quot; )</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sqlite3 is limited to 16 significant digits of precision</span></span><br><span class="line">				while( match( $0, /0x[0-9a-fA-F]&#123;17&#125;/ ) )&#123;</span><br><span class="line">						hexIssue = 1</span><br><span class="line">								sub( /0x[0-9a-fA-F]+/, substr( $0, RSTART, RLENGTH-1 ), $0 )</span><br><span class="line">				&#125;</span><br><span class="line">				if( hexIssue )&#123;</span><br><span class="line">						printerr( \</span><br><span class="line">										NR &quot;: WARN Hex number trimmed (length longer than 16 chars).&quot; )</span><br><span class="line">								hexIssue = 0</span><br><span class="line">				&#125;</span><br><span class="line">				print</span><br><span class="line">						next</span><br><span class="line">				&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CREATE DATABASE is not supported</span></span><br><span class="line">/^(CREATE DATABASE|create database)/ &#123; next &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">print</span> the CREATE line as is and capture the table name</span></span><br><span class="line">/^(CREATE|create)/ &#123;</span><br><span class="line">		if( $0 ~ /IF NOT EXISTS|if not exists/ || $0 ~ /TEMPORARY|temporary/ )&#123;</span><br><span class="line">				caseIssue = 1</span><br><span class="line">						printerr( \</span><br><span class="line">										NR &quot;: WARN Potential case sensitivity issues with table/column naming\n&quot; \</span><br><span class="line">										&quot;          (see INFO at the end).&quot; )</span><br><span class="line">		&#125;</span><br><span class="line">		if( match( $0, /`[^`]+/ ) )&#123;</span><br><span class="line">				tableName = substr( $0, RSTART+1, RLENGTH-1 )</span><br><span class="line">		&#125;</span><br><span class="line">		aInc = 0</span><br><span class="line">				prev = &quot;&quot;</span><br><span class="line">				firstInTable = 1</span><br><span class="line">				print</span><br><span class="line">				next</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replace `FULLTEXT KEY` (probably other `XXXXX KEY`)</span></span><br><span class="line">/^  (FULLTEXT KEY|fulltext key)/ &#123; gsub( /[A-Za-z ]+(KEY|key)/, &quot;  KEY&quot; ) &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Get rid of field lengths <span class="keyword">in</span> KEY lines</span></span><br><span class="line">/ (PRIMARY |primary )?(KEY|key)/ &#123; gsub( /\([0-9]+\)/, &quot;&quot; ) &#125;</span><br><span class="line"></span><br><span class="line">aInc == 1 &amp;&amp; /PRIMARY KEY|primary key/ &#123; next &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replace COLLATE xxx_xxxx_xx statements with COLLATE BINARY</span></span><br><span class="line">/ (COLLATE|collate) [a-z0-9_]*/ &#123; gsub( /(COLLATE|collate) [a-z0-9_]*/, &quot;COLLATE BINARY&quot; ) &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Print all fields definition lines except the `KEY` lines.</span></span><br><span class="line">/^  / &amp;&amp; !/^(  (KEY|key)|\);)/ &#123;</span><br><span class="line">		if( match( $0, /[^&quot;`]AUTO_INCREMENT|auto_increment[^&quot;`]/) )&#123;</span><br><span class="line">				aInc = 1</span><br><span class="line">						gsub( /AUTO_INCREMENT|auto_increment/, &quot;PRIMARY KEY AUTOINCREMENT&quot; )</span><br><span class="line">		&#125;</span><br><span class="line">		gsub( /(UNIQUE KEY|unique key) (`.*`|&quot;.*&quot;) /, &quot;UNIQUE &quot; )</span><br><span class="line">				gsub( /(CHARACTER SET|character set) [^ ]+[ ,]/, &quot;&quot; )</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">FIXME</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  CREATE TRIGGER [UpdateLastTime]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  AFTER UPDATE</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  ON Package</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  FOR EACH ROW</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  BEGIN</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  UPDATE Package SET LastUpdate = CURRENT_TIMESTAMP WHERE ActionId = old.ActionId;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  END</span></span><br><span class="line">				gsub( /(ON|on) (UPDATE|update) (CURRENT_TIMESTAMP|current_timestamp)(\(\))?/, &quot;&quot; )</span><br><span class="line">				gsub( /(DEFAULT|default) (CURRENT_TIMESTAMP|current_timestamp)(\(\))?/, &quot;DEFAULT current_timestamp&quot;)</span><br><span class="line">				gsub( /(COLLATE|collate) [^ ]+ /, &quot;&quot; )</span><br><span class="line">				gsub( /(ENUM|enum)[^)]+\)/, &quot;text &quot; )</span><br><span class="line">				gsub( /(SET|set)\([^)]+\)/, &quot;text &quot; )</span><br><span class="line">				gsub( /UNSIGNED|unsigned/, &quot;&quot; )</span><br><span class="line">				gsub( /_utf8mb3/, &quot;&quot; )</span><br><span class="line">				gsub( /` [^ ]*(INT|int|BIT|bit)[^ ]*/, &quot;` integer&quot; )</span><br><span class="line">				gsub( /&quot; [^ ]*(INT|int|BIT|bit)[^ ]*/, &quot;\&quot; integer&quot; )</span><br><span class="line">				ere_bit_field = &quot;[bB]&#x27;[10]+&#x27;&quot;</span><br><span class="line">				if( match($0, ere_bit_field) )&#123;</span><br><span class="line">						sub( ere_bit_field, bit_to_int( substr( $0, RSTART +2, RLENGTH -2 -1 ) ) )</span><br><span class="line">				&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">remove USING BTREE and other suffixes <span class="keyword">for</span> USING, <span class="keyword">for</span> example: <span class="string">&quot;UNIQUE KEY</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">`hostname_domain` (`hostname`,`domain`) USING BTREE,&quot;</span></span></span><br><span class="line">		gsub( / USING [^, ]+/, &quot;&quot; )</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">field comments are not supported</span></span><br><span class="line">				gsub( / (COMMENT|comment).+$/, &quot;&quot; )</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Get commas off end of line</span></span><br><span class="line">				gsub( /,.?$/, &quot;&quot; )</span><br><span class="line">				if( prev )&#123;</span><br><span class="line">						if( firstInTable )&#123;</span><br><span class="line">								print prev</span><br><span class="line">										firstInTable = 0</span><br><span class="line">						&#125;</span><br><span class="line">						else &#123;</span><br><span class="line">								print &quot;,&quot; prev</span><br><span class="line">						&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				else &#123;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">FIXME check <span class="keyword">if</span> this is correct <span class="keyword">in</span> all cases</span></span><br><span class="line">						if( match( $1,</span><br><span class="line">												/(CONSTRAINT|constraint) [&quot;].*[&quot;] (FOREIGN KEY|foreign key)/ ) )&#123;</span><br><span class="line">								print &quot;,&quot;</span><br><span class="line">						&#125;</span><br><span class="line">				&#125;</span><br><span class="line">		prev = $1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/ ENGINE| engine/ &#123;</span><br><span class="line">		if( prev )&#123;</span><br><span class="line">				if( firstInTable )&#123;</span><br><span class="line">						print prev</span><br><span class="line">								firstInTable = 0</span><br><span class="line">				&#125;</span><br><span class="line">				else &#123;</span><br><span class="line">						print &quot;,&quot; prev</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		prev=&quot;&quot;</span><br><span class="line">				print &quot;);&quot;</span><br><span class="line">				next</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">`KEY` lines are extracted from the `CREATE` block and stored <span class="keyword">in</span> array <span class="keyword">for</span> later <span class="built_in">print</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">in</span> a separate `CREATE KEY` <span class="built_in">command</span>. The index name is prefixed by the table name to</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">avoid a sqlite error <span class="keyword">for</span> duplicate index name.</span></span><br><span class="line">/^(  (KEY|key)|\);)/ &#123;</span><br><span class="line">		if( prev )&#123;</span><br><span class="line">				if( firstInTable )&#123;</span><br><span class="line">						print prev</span><br><span class="line">								firstInTable = 0</span><br><span class="line">				&#125;</span><br><span class="line">				else &#123;</span><br><span class="line">						print &quot;,&quot; prev</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		prev = &quot;&quot;</span><br><span class="line">				if( $0 == &quot;);&quot; )&#123;</span><br><span class="line">						print</span><br><span class="line">				&#125;</span><br><span class="line">				else &#123;</span><br><span class="line">						if( match( $0, /`[^`]+/ ) )&#123;</span><br><span class="line">								indexName = substr( $0, RSTART+1, RLENGTH-1 )</span><br><span class="line">						&#125;</span><br><span class="line">						if( match( $0, /\([^()]+/ ) )&#123;</span><br><span class="line">								indexKey = substr( $0, RSTART+1, RLENGTH-1 )</span><br><span class="line">						&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">idx_ prefix to avoid name clashes (they really happen!)</span></span><br><span class="line">						key[tableName] = key[tableName] &quot;CREATE INDEX \&quot;idx_&quot; \</span><br><span class="line">										 tableName &quot;_&quot; indexName &quot;\&quot; ON \&quot;&quot; tableName &quot;\&quot; (&quot; indexKey &quot;);\n&quot;</span><br><span class="line">				&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">END &#123;</span><br><span class="line">		if( no_END )&#123; exit 1&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">print</span> all KEY creation lines.</span></span><br><span class="line">		for( table in key )&#123; printf key[table] &#125;</span><br><span class="line"></span><br><span class="line">		print &quot;END TRANSACTION;&quot;</span><br><span class="line"></span><br><span class="line">				if( caseIssue )&#123;</span><br><span class="line">						printerr( \</span><br><span class="line">										&quot;INFO Pure sqlite identifiers are case insensitive (even if quoted\n&quot; \</span><br><span class="line">										&quot;     or if ASCII) and doesnt cross-check TABLE and TEMPORARY TABLE\n&quot; \</span><br><span class="line">										&quot;     identifiers. Thus expect errors like \&quot;table T has no column named F\&quot;.&quot;)</span><br><span class="line">				&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://aquarian-age.github.io/2021/09/29/Mysql2SQLite3/" data-id="claelm5vu0008x8m15djbffue" class="article-share-link">分享</a>
      
      
        <a href="https://aquarian-age.github.io/2021/09/29/Mysql2SQLite3/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go/" rel="tag">Go</a></li></ul>

    </footer>
  </div>
  
    
 
<script src="/jquery/jquery.min.js"></script>

  <div id="random_posts">
    <h2>推荐文章</h2>
    <div class="random_posts_ul">
      <script>
          var random_count =4
          var site = {BASE_URI:'/'};
          function load_random_posts(obj) {
              var arr=site.posts;
              if (!obj) return;
              // var count = $(obj).attr('data-count') || 6;
              for (var i, tmp, n = arr.length; n; i = Math.floor(Math.random() * n), tmp = arr[--n], arr[n] = arr[i], arr[i] = tmp);
              arr = arr.slice(0, random_count);
              var html = '<ul>';
            
              for(var j=0;j<arr.length;j++){
                var item=arr[j];
                html += '<li><strong>' + 
                item.date + ':&nbsp;&nbsp;<a href="' + (site.BASE_URI+item.uri) + '">' + 
                (item.title || item.uri) + '</a></strong>';
                if(item.excerpt){
                  html +='<div class="post-excerpt">'+item.excerpt+'</div>';
                }
                html +='</li>';
                
              }
              $(obj).html(html + '</ul>');
          }
          $('.random_posts_ul').each(function () {
              var c = this;
              if (!site.posts || !site.posts.length){
                  $.getJSON(site.BASE_URI + 'js/posts.js',function(json){site.posts = json;load_random_posts(c)});
              } 
               else{
                load_random_posts(c);
              }
          });
      </script>
    </div>
  </div>

    
<nav id="article-nav">
  
    <a href="/2021/10/06/%E9%B9%A6%E9%B9%89/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          鹦鹉
        
      </div>
    </a>
  
  
    <a href="/2021/09/28/golangAPI/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">Go语言后端api</div>
    </a>
  
</nav>

  
</article>
 
     
  <div class="comments" id="comments">
    
     
    <section id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
      </section>
      
       
       
      
      
  </div>
 
  

</section>
           
    <aside id="sidebar">
  
    

  
    
  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title recent-posts">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/02/03/%E7%99%B8%E5%8D%AF/">癸卯</a>
          </li>
        
          <li>
            <a href="/2023/02/03/%E9%99%8C/">陌</a>
          </li>
        
          <li>
            <a href="/2023/01/27/%E5%A5%87%E9%97%A8%E5%B1%80/">奇门局</a>
          </li>
        
          <li>
            <a href="/2023/01/27/%E5%AF%B9%E8%81%94%E6%88%90%E8%AF%97/">对联成诗</a>
          </li>
        
          <li>
            <a href="/2023/01/27/%E7%BA%A2%E6%A5%BC/">红楼</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    

  
    
  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2023 Aquarian-Age&nbsp;|&nbsp;
      主题 <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;liangzi@yandex.com
    </div>
  </div>
</footer>
 
<script src="/jquery/jquery.min.js"></script>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="https://aquarian-age.github.io/2018/01/31/about/" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
      

<script>
  var disqus_shortname = 'Aquarian-Age';
  
  var disqus_url = 'https://aquarian-age.github.io/2021/09/29/Mysql2SQLite3/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

<!-- author:forvoid end -->

<!-- author:forvoid end -->



 
<script src="/js/is.js"></script>



  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


<script src="/js/elevator.js"></script>

  </div>
</body>
</html>
